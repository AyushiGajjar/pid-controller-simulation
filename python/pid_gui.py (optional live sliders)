import tkinter as tk
from tkinter import ttk
import numpy as np
import matplotlib.pyplot as plt
from pid_simulation import simulate_numpy

def run_sim():
    kp = float(kp_var.get())
    ki = float(ki_var.get())
    kd = float(kd_var.get())
    tau = float(tau_var.get())
    t, r, y, u = simulate_numpy(plant="first", tau=tau, kp=kp, ki=ki, kd=kd, tend=10.0, dt=0.001)
    plt.figure()
    plt.plot(t, r, label="Reference")
    plt.plot(t, y, label="Output")
    plt.title(f"First-Order Plant (tau={tau}) | Kp={kp}, Ki={ki}, Kd={kd}")
    plt.xlabel("Time (s)"); plt.ylabel("Amplitude"); plt.grid(True); plt.legend(); plt.tight_layout()
    plt.show()

root = tk.Tk()
root.title("PID Tuning (First-Order)")

kp_var = tk.DoubleVar(value=1.0)
ki_var = tk.DoubleVar(value=0.0)
kd_var = tk.DoubleVar(value=0.0)
tau_var = tk.DoubleVar(value=1.0)

for text, var in [("Kp", kp_var), ("Ki", ki_var), ("Kd", kd_var), ("Tau", tau_var)]:
    frame = ttk.Frame(root); frame.pack(fill="x", padx=10, pady=5)
    ttk.Label(frame, text=text, width=6).pack(side="left")
    scale = ttk.Scale(frame, from_=0.0, to=5.0, orient="horizontal", variable=var)
    scale.pack(side="left", fill="x", expand=True, padx=8)
    entry = ttk.Entry(frame, textvariable=var, width=8)
    entry.pack(side="right")

ttk.Button(root, text="Simulate", command=run_sim).pack(pady=10)
root.mainloop()
